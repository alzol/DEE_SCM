# 5. Physical implementation in a Test Network

### 5.1         The Test Network

MVP



Proof of Work

## 

### 5.1.1 **Used Hardware**

For testing, three laptops were set up as miners and two Raspberrys Pi 3 as nodes. 

![](.gitbook/assets/network.PNG)

### 5.1.2 Install an Ethereum node on a Raspberry Pi

Raspberry Pis were chosen because they are cheap and easy to set up compared to laptops or computers. Also, the computing power should be sufficient to operate a node.

The Raspberry Pi has been assembled according to the instructions included in the box and has a USB mouse and USB keyboard connected. A screen was connected via HDMI cable and a LAN cable was plugged in. After the installation they were operated via WLAN.

The installation of the Raspberrys was done according to the instructions of [ChainSkills](http://chainskills.com/2017/02/24/create-a-private-ethereum-blockchain-with-iot-devices-16/). This series of tutorials describes how to set up a private Ethereum blockchain that will be composed of a computer \(miner\) and one or several Raspberry PI 3 devices \(nodes\).

The setup of the Raspberry Pi requires the following hardware:

* A Raspberry Pi
* An SD Card with at least 16Gb
* A LAN cable
* A keyboard
* A display

**Steps to perform**

* Format the SD-Card in FAT32.
* Download the Raspbian image and write it to the SD-Card .
* Make our preferred adjustments \(language, tastatur layout, Wi-Fi, SSH\).
* Connect via PuTTY.
* Install and run [Geth](https://geth.ethereum.org/downloads/).

### 5.1.3 Install an Ethereum miner on a computer and initializing the blockchain

For the installation of the Ethereum miners on Windows computers, we followed the instruction of [ChainSkills](http://chainskills.com/2017/03/03/install-a-ethereum-node-on-a-computer-26/). 

**Steps to perform**

* Installation of [Geth ](https://geth.ethereum.org/downloads/)
* Initialization of a private Blockchain with our [genesis.json](https://github.com/Ricardo-Cz/DEE_SCM/blob/master/genesis.json) file for each miner.
* Creation of accounts for each miner and node.
* Preparation of each miner with our [start parameters](https://github.com/Ricardo-Cz/DEE_SCM/blob/master/startminer1.bat).
* Testing of each miner.
* Deleting the private Blockchain of each miner.
* Pairing and synchronizing of the three miners by configuring our [static-nodes.json](https://github.com/Ricardo-Cz/DEE_SCM/blob/master/static-nodes.json) parameters. \(Hardest step.\)
* Pairing and Synchronizing the Raspberry PIs with our miners by configuring our [static-nodes.json ](https://github.com/Ricardo-Cz/DEE_SCM/blob/master/static-nodes.json)parameters.
* Connecting to our mining network via [Mist browser](https://github.com/ethereum/mist).

## 

### 5.2         Structure of the Smart Contract

The Smart Contract is deployed via [Mist browser](https://github.com/ethereum/mist) to our private Ethereum blockchain. It represents a trading platform, which can be used by the five actors. They can perform the following activities:

* Charge their prepaid account with ether
* Offer energy for a specified ether price
* Buy a specific amount of energy for the offered ether price

Each of these activities is realized by a function of the Smart Contract. 

**For the realization of these functions, the Smart Contract has...**

* its own ether wallet to store the total prepaid balance of all actors. 
* five account variables to store the prepaid balance of each actor. The logic for the separation is implemented in the charging and buying function.
* five price variables to store the offers of each actor.

![Overview of the Smart Contract](.gitbook/assets/image%20%282%29.png)

The solidity source code of the Smart Contract can be found [here](https://github.com/Ricardo-Cz/DEE_SCM/blob/master/EnergyBlockchain.1.sol).

## 

### 5.3 Sample Scenario

1. "Load" charges its prepaid account with 40 Ether.
2. "Chp" offers each kw for 3 Ether.
3. "Load" buys 10 kw from "Chp" for 30 Ether.



#### 5.3.1 **"Load" charges its prepaid account with 40 Ether.**

To charge the prepaid account, "Load" executes the PayMe function of the SmartContract with the chosen amount of Ether. The Ether will be transferred from the "Load" wallet to the Smart Contract wallet. The Smart Contract recognizes who sent the Ether and increases the corresponding account balance variable.

![Logic](.gitbook/assets/image%20%2814%29.png)

**Steps:**

{% tabs %}
{% tab title="Step 1" %}


![Choose function and amount of ether](.gitbook/assets/image%20%289%29.png)
{% endtab %}

{% tab title="Step 2" %}


![Send Ether from &quot;Load&quot; wallet to contract wallet](.gitbook/assets/image%20%2815%29.png)
{% endtab %}

{% tab title="Step 3" %}
![Writing the transaction into the blockchain](.gitbook/assets/image%20%286%29.png)
{% endtab %}

{% tab title="Step 4" %}


![Wallet of the contract \(top right\) and prepaid balance of &quot;load&quot;](.gitbook/assets/image%20%2827%29.png)
{% endtab %}
{% endtabs %}



#### 5.3.2 "Chp" offers each kw for 3 Ether.

To publish an offer, "Chp" executes the bid function with the corresponding "Chp kw" value. The smart contract recognizes who executes the function. Therefore each actor can only change its own offers.

![Logic](.gitbook/assets/image%20%2819%29.png)

  
**Steps:**

{% tabs %}
{% tab title="Step 1" %}


![CHP changes its price per kw](.gitbook/assets/image%20%2816%29.png)
{% endtab %}

{% tab title="Step 2" %}


![The new offer is saved in the Smart Contract](.gitbook/assets/image%20%287%29.png)
{% endtab %}
{% endtabs %}

#### 

#### 5.3.3 "Load" buys 10 kw from "Chp" for 30 Ether

"Load" looks which actor has the cheapest price per kw. Afterwards chooses how much kw should be bought from which actor and executes the "Energy Tokens" function. The Smart Contract will check, if "Load" has enough prepaid balance to perform this transaction. If so, the Smart Contract will send the corresponding amount of ether from its wallet to the wallet of all involved actors. The prepaid balance of "Load" will be reduced.

![Logic](.gitbook/assets/image%20%288%29.png)

  
**Steps:**

{% tabs %}
{% tab title="Step 1" %}


![Load looks for the best price offer](.gitbook/assets/image%20%287%29.png)
{% endtab %}

{% tab title="Step 2" %}


![Load decides to buy 10 kw per 3 Ether from Chp](.gitbook/assets/image%20%285%29.png)
{% endtab %}

{% tab title="Step 3" %}
![Chp received 30 Ether from the Smart Contract wallet](.gitbook/assets/image%20%2822%29.png)
{% endtab %}

{% tab title="Step 4" %}
![Wallet of Smart Contract and prepaid balance of &quot;Load&quot; decreased by 30 Ether](.gitbook/assets/image%20%2826%29.png)
{% endtab %}
{% endtabs %}

![Sequencediagram of the smart contract procedure](.gitbook/assets/smart-contract-usage.png)

